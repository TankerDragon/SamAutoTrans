{% extends 'budget-main.html' %} {% block content %} {% load static %}

<div class="container">
  <div class="table">
    <div class="row">
      <div class="table-container">
        <h1>Budget statistics</h1>
        <table>
          <thead>
            <tr>
              <td>Budget type</td>
              <td>Total Amount</td>
              <td>Weekly change</td>
              <td>Monthly change</td>
              <td>Yearly change</td>
            </tr>
          </thead>
          <tbody class="first-bold">
            <tr>
              <td>Lane Budget</td>
              <td>{{l_total}}<d_total + r_total/td></td>
              <td>{{data.week.L}}</td>
              <td>{{data.month.L}}</td>
              <td>{{data.year.L}}</td>
            </tr>
            <tr>
              <td>Driver Budget</td>
              <td>{{d_total}}</td>
              <td>{{data.week.D}}</td>
              <td>{{data.month.D}}</td>
              <td>{{data.year.D}}</td>
            </tr>
            <tr>
              <td>Recovery Budget</td>
              <td>{{r_total}}</td>
              <td>{{data.week.R}}</td>
              <td>{{data.month.R}}</td>
              <td>{{data.year.R}}</td>
            </tr>
            <tr>
              <td>Total</td>
              <td>{{total}}</td>
              <td>{{data.week.T}}</td>
              <td>{{data.month.T}}</td>
              <td>{{data.year.T}}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div id="chartContainer" style="height: 370px"></div>
    </div>

    <div class="row">
      <h1>Budget</h1>
      <input type="text" id="search-input" onkeyup="search()" placeholder="Search by name..." />
    </div>
    <table>
      <thead class="sticky">
        <td>First name</td>
        <td>Last name</td>
        <td>Driver type</td>
        <td>Driver's Budget</td>
        <td>Lane Budget</td>
        <td>Recovery Budget</td>
        <td>Total Budget</td>
        <td>Actions</td>
      </thead>
      <tbody id="tbody">
        {% for driver in drivers %}
        <tr>
          <td>{{driver.first_name}}</td>
          <td>{{driver.last_name}}</td>
          <td>{% if driver.driver_type == "OO"%}Owner{% elif driver.driver_type == "CD" %}Company{% elif driver.driver_type == "LO" %}Lease{% endif %}</td>
          <td>{{driver.d_budget}}</td>
          <td>{{driver.l_budget}}</td>
          <td>{{driver.r_budget}}</td>
          <td>{{driver.total_budget}}</td>
          <td class="highLited">
            <i class="fa-solid fa-dollar-sign" onclick="modify(this, {{driver.id}})"></i>
            <i onclick="archive({{ driver.id }})" class="fa-solid fa-clock-rotate-left"></i>
            <i onclick="driver_detail({{ driver.id }})" class="fa-solid fa-user"></i>
            <i class="fa-solid fa-chart-line"></i>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
<div id="form">
  <div class="title-bar">Add to Budget</div>
  <div class="contain">
    <div id="csrf">{% csrf_token %}</div>
    <label for="f-name">Full name:</label>
    <div id="full-name"></div>
    <label for="amount">Change of amount:</label>
    <input id="input-amount" type="number" />
    <label for="b-type">Budget type:</label>
    <select name="budget-type" id="budget-type">
      <option value="D">Driver's Budget</option>
      <option value="L">Lane Budget</option>
      <option value="R">Recovery Budget</option>
    </select>
    <label for="amount">BOL number:</label>
    <input id="bol-number" type="text" />
    <label for="amount">PCS number:</label>
    <input id="pcs-number" type="text" />
    <label for="amount">Note: </label>
    <input id="note" type="text" />
    <div class="buttons">
      <button onclick="submit()">Submit</button>
      <button onclick="cancel()">Cancel</button>
    </div>
  </div>
</div>
<script src="{% static 'js/budget.js' %}"></script>
<script src="{% static 'js/lib/canvasjs.min.js' %}"></script>

<script>
  let l_total = {{l_total}}, d_total = {{d_total}}, r_total = {{r_total}}, total = {{total}};
  window.onload = function () {
    var chart = new CanvasJS.Chart("chartContainer", {
      animationEnabled: true,
      title: {
        text: "Total Amount",
        horizontalAlign: "center",
      },
      data: [
        {
          theme: "dark2",
          type: "doughnut",
          startAngle: 60,
          innerRadius: 60,
          indexLabelFontSize: 17,
          indexLabel: "{label} - #percent%",
          toolTipContent: "<b>{label}:</b> {y} (#percent%)",
          dataPoints: [
            { y: total/l_total, label: "Lane Budget" },
            { y: total/d_total, label: "Driver Budget" },
            { y: total/r_total, label: "Recovery Budget" },
          ],
        },
      ],
    });
    chart.render();
  };
</script>

{% endblock %}
